<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>폴리곤 테스트</title>
    <!-- 네이버 지도 API -->
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=xzbnwd2h1z&submodules=geocoder,panorama"></script>
    <style>
        #map { width: 100%; height: 600px; }
        .controls { margin: 10px; }
        .log { margin: 10px; padding: 10px; background: #f5f5f5; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="controls">
        <h2>폴리곤 렌더링 테스트</h2>
        <button onclick="testPolygon()">테스트 폴리곤 그리기</button>
        <button onclick="clearLog()">로그 지우기</button>
    </div>
    
    <div id="map"></div>
    
    <div class="log" id="log"></div>

    <script>
        let map;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // 지도 초기화
        function initMap() {
            log('🗺️ 지도 초기화 시작');
            
            const mapOptions = {
                center: new naver.maps.LatLng(37.5666, 126.9784), // 서울시청
                zoom: 18,
                mapTypeId: naver.maps.MapTypeId.NORMAL
            };
            
            map = new naver.maps.Map('map', mapOptions);
            log('✅ 지도 초기화 완료');
            
            // 지도 클릭 이벤트
            naver.maps.Event.addListener(map, 'click', function(e) {
                const coord = e.coord;
                log(`🖱️ 지도 클릭: ${coord.lat().toFixed(6)}, ${coord.lng().toFixed(6)}`);
            });
        }
        
        // 테스트 폴리곤 그리기
        function testPolygon() {
            log('🎨 테스트 폴리곤 그리기 시작');
            
            if (!map) {
                log('❌ 지도가 초기화되지 않았습니다');
                return;
            }
            
            // 서울시청 주변 사각형 폴리곤 (더 큰 크기로)
            const center = map.getCenter();
            const lat = center.lat();
            const lng = center.lng();
            const offset = 0.002; // 약 200m
            
            const paths = [
                new naver.maps.LatLng(lat + offset, lng - offset),
                new naver.maps.LatLng(lat + offset, lng + offset),
                new naver.maps.LatLng(lat - offset, lng + offset),
                new naver.maps.LatLng(lat - offset, lng - offset),
                new naver.maps.LatLng(lat + offset, lng - offset)
            ];
            
            log(`📍 폴리곤 경로 점 개수: ${paths.length}`);
            log(`📍 중심점: ${lat.toFixed(6)}, ${lng.toFixed(6)}`);
            log(`📍 첫 번째 점: ${paths[0].lat().toFixed(6)}, ${paths[0].lng().toFixed(6)}`);
            
            try {
                const polygon = new naver.maps.Polygon({
                    map: map,
                    paths: paths,
                    fillColor: '#FF0000',
                    fillOpacity: 0.7,
                    strokeColor: '#0000FF',
                    strokeOpacity: 1.0,
                    strokeWeight: 3,
                    clickable: true,
                    zIndex: 1000
                });
                
                log('✅ 폴리곤 객체 생성 완료');
                
                // 폴리곤 속성 확인
                setTimeout(() => {
                    const bounds = polygon.getBounds();
                    if (bounds) {
                        log(`📊 폴리곤 bounds: ${bounds.toString()}`);
                        
                        // 지도를 폴리곤에 맞게 조정
                        map.fitBounds(bounds);
                        log('🎯 지도를 폴리곤에 맞게 조정');
                    }
                    
                    // 폴리곤이 실제로 지도에 표시되어 있는지 확인
                    const mapInstance = polygon.getMap();
                    log(`🗺️ 폴리곤의 지도 인스턴스: ${mapInstance ? '있음' : '없음'}`);
                }, 1000);
                
                // 클릭 이벤트
                naver.maps.Event.addListener(polygon, 'click', function(e) {
                    log('🖱️ 폴리곤 클릭됨');
                    
                    // 색상 변경
                    const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    
                    polygon.setOptions({
                        fillColor: randomColor,
                        strokeColor: randomColor,
                        fillOpacity: 0.8,
                        strokeWeight: 5
                    });
                    
                    log(`🎨 폴리곤 색상 변경: ${randomColor}`);
                });
                
                // 폴리곤 강제 새로고침
                polygon.setMap(null);
                polygon.setMap(map);
                log('🔄 폴리곤 강제 새로고침 완료');
                
            } catch (error) {
                log(`❌ 폴리곤 생성 실패: ${error.message}`);
            }
        }
        
        // 페이지 로드 시 초기화
        window.onload = function() {
            log('📄 페이지 로드 완료');
            
            if (typeof naver === 'undefined' || typeof naver.maps === 'undefined') {
                log('❌ 네이버 지도 API가 로드되지 않았습니다');
                return;
            }
            
            log('✅ 네이버 지도 API 로드 확인');
            initMap();
        };
    </script>
</body>
</html>