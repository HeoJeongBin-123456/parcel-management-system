<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#667eea">
    <title>NAVER Maps Field Management Program</title>
    
    <!-- ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ API -->
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=xzbnwd2h1z&submodules=geocoder,panorama"></script>
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- html2canvas for screenshot capture -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/advanced-ui.css">
    <link rel="stylesheet" href="/css/business-style.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/backup-ui.css">
    <link rel="stylesheet" href="/css/modes.css">
</head>
<body>
    <div id="app">
        <!-- Ìó§Îçî ÏòÅÏó≠ -->
        <header class="header">
            <h1 style="color: white;">ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ ÌïÑÏßÄ Í¥ÄÎ¶¨ ÌîÑÎ°úÍ∑∏Îû®</h1>
            <div id="connectionStatus" class="connection-status disconnected">üî¥ Ïó∞Í≤∞ Ï§ë...</div>
            <div class="header-controls">
                <!-- Î™®Îìú ÏÑ†ÌÉù Î≤ÑÌäº Ï∂îÍ∞Ä -->
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="click" title="ÌÅ¥Î¶≠ Î™®Îìú">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7V12C2 16.5 4.23 20.68 7.62 23.15L12 24L16.38 23.15C19.77 20.68 22 16.5 22 12V7L12 2Z" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3" fill="currentColor"/>
                        </svg>
                        <span>ÌÅ¥Î¶≠</span>
                    </button>
                    <button class="mode-btn" data-mode="search" title="Í≤ÄÏÉâ Î™®Îìú">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Í≤ÄÏÉâ</span>
                    </button>
                    <button class="mode-btn" data-mode="hand" title="ÏÜê Î™®Îìú">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M18 11L18 6C18 5.45 17.55 5 17 5C16.45 5 16 5.45 16 6V11" stroke="currentColor" stroke-width="2"/>
                            <path d="M16 11V4C16 3.45 15.55 3 15 3C14.45 3 14 3.45 14 4V11" stroke="currentColor" stroke-width="2"/>
                            <path d="M14 11V5C14 4.45 13.55 4 13 4C12.45 4 12 4.45 12 5V11" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 11V7C12 6.45 11.55 6 11 6C10.45 6 10 6.45 10 7V15" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 15L10 12C10 11.45 9.55 11 9 11C8.45 11 8 11.45 8 12V16C8 20 11 21 11 21H17C17 21 20 20 20 16V11C20 10.45 19.55 10 19 10C18.45 10 18 10.45 18 11" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>ÏÜê</span>
                    </button>
                </div>

                <!-- ÏßÄÎèÑ ÌÉÄÏûÖ ÏÑ†ÌÉù -->
                <div class="map-type-selector">
                    <button class="map-type-btn active" data-type="normal">ÏùºÎ∞òÏßÄÎèÑ</button>
                    <button class="map-type-btn" data-type="satellite">ÏúÑÏÑ±ÏßÄÎèÑ</button>
                    <button class="map-type-btn" data-type="cadastral">ÏßÄÏ†ÅÌé∏ÏßëÎèÑ</button>
                    <button class="map-type-btn" data-type="street">Í±∞Î¶¨Î∑∞</button>
                </div>
                
                <!-- Í≤ÄÏÉâ -->
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="ÏßÄÎ≤à ÎòêÎäî Ï£ºÏÜå Í≤ÄÏÉâ">
                    <button id="searchBtn">Í≤ÄÏÉâ</button>
                    <div class="search-mode-indicator" style="display: none;">
                        <span class="search-mode-badge">Í≤ÄÏÉâ Î™®Îìú</span>
                        <button id="clearSearchBtn" class="clear-search-btn" title="Í≤ÄÏÉâ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Ï∫òÎ¶∞Îçî Î≤ÑÌäº -->
                <button id="calendarBtn" class="header-calendar-btn" onclick="openCalendarModal()" title="ÏóÖÎ¨¥ Ï∫òÎ¶∞Îçî">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                        <line x1="3" y1="9" x2="21" y2="9" stroke="currentColor" stroke-width="2"/>
                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <rect x="7" y="12" width="3" height="3" rx="0.5" fill="currentColor"/>
                        <rect x="14" y="12" width="3" height="3" rx="0.5" fill="currentColor"/>
                        <rect x="7" y="17" width="3" height="3" rx="0.5" fill="currentColor"/>
                    </svg>
                    <span>Ï∫òÎ¶∞Îçî</span>
                </button>
                
                <!-- Î∞±ÏóÖ Í¥ÄÎ¶¨ Î≤ÑÌäº -->
                <button id="backupBtn" class="header-backup-btn" onclick="openBackupModal()" title="Î∞±ÏóÖ Í¥ÄÎ¶¨">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
                        <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                        <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                        <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                        <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Î∞±ÏóÖ</span>
                </button>
                
            </div>
        </header>

        <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
        <div class="main-container">
            <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <aside class="sidebar">
            <!-- ÏÉâÏÉÅ ÏÑ†ÌÉù Ìå®ÎÑê -->
            <div class="color-panel">
                <h3>ÌïÑÏßÄ ÏÉâÏÉÅ <span class="mode-badge">ÌÅ¥Î¶≠ Î™®Îìú</span></h3>
                <div class="color-palette" id="colorPalette">
                    <div class="color-item active" data-color="0" data-hex="#FF0000" style="background: #FF0000" title="Îπ®Í∞ï"></div>
                    <div class="color-item" data-color="1" data-hex="#FFA500" style="background: #FFA500" title="Ï£ºÌô©"></div>
                    <div class="color-item" data-color="2" data-hex="#FFFF00" style="background: #FFFF00" title="ÎÖ∏Îûë"></div>
                    <div class="color-item" data-color="3" data-hex="#90EE90" style="background: #90EE90" title="Ïó∞Îëê"></div>
                    <div class="color-item" data-color="4" data-hex="#0000FF" style="background: #0000FF" title="ÌååÎûë"></div>
                    <div class="color-item" data-color="5" data-hex="#000000" style="background: #000000" title="Í≤ÄÏ†ï"></div>
                    <div class="color-item" data-color="6" data-hex="#FFFFFF" style="background: #FFFFFF; border: 1px solid #ccc" title="Ìù∞ÏÉâ"></div>
                    <div class="color-item" data-color="7" data-hex="#87CEEB" style="background: #87CEEB" title="ÌïòÎäòÏÉâ"></div>
                </div>
                <div class="current-color">
                    <span>ÏÑ†ÌÉùÎêú ÏÉâÏÉÅ:</span>
                    <div id="currentColor" style="background: #FF0000"></div>
                </div>
                <div class="color-stats">
                    <span id="colorStats">Ï¥ù 0Í∞ú ÌïÑÏßÄ</span>
                </div>
            </div>

            <!-- ÌïÑÏßÄ Ï†ïÎ≥¥ ÏûÖÎ†• -->
            <div class="parcel-info">
                <h3>ÌïÑÏßÄ Ï†ïÎ≥¥</h3>
                <form id="parcelForm">
                    <div class="form-group">
                        <label>ÏßÄÎ≤à</label>
                        <input type="text" id="parcelNumber" placeholder="Ïòà: 123-4">
                    </div>
                    <div class="form-group">
                        <label>ÏÜåÏú†Ïûê Ïù¥Î¶Ñ</label>
                        <input type="text" id="ownerName" placeholder="ÌôçÍ∏∏Îèô">
                    </div>
                    <div class="form-group">
                        <label>ÏÜåÏú†Ïûê Ï£ºÏÜå</label>
                        <input type="text" id="ownerAddress" placeholder="ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨...">
                    </div>
                    <div class="form-group">
                        <label>Ïó∞ÎùΩÏ≤ò</label>
                        <input type="text" id="ownerContact" placeholder="010-1234-5678">
                    </div>
                    <div class="form-group">
                        <label>Î©îÎ™®</label>
                        <textarea id="memo" rows="3" placeholder="Ï∂îÍ∞Ä Î©îÎ™®..." style="resize: vertical; min-height: 60px;"></textarea>
                    </div>
                    <div class="form-buttons">
                        <button type="button" id="saveBtn">Ï†ÄÏû•</button>
                        <!-- Ï¥àÍ∏∞Ìôî Î≤ÑÌäº Ï†úÍ±∞Îê®: Í∞úÎ≥Ñ ÏÇ≠Ï†úÎßå Í∞ÄÎä• -->
                        <button type="button" id="deleteParcelBtn" style="background-color: #6c757d; color: white;">ÌïÑÏßÄ Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî</button>
                    </div>
                    <div class="export-buttons">
                        <button type="button" id="exportCurrentBtn" onclick="exportCurrentParcelToGoogleSheets()">
                            Íµ¨Í∏Ä ÏãúÌä∏ Ï†ÑÏÜ°
                        </button>
                        <button type="button" id="copyDataBtn" onclick="copyDataToClipboard()">
                            ÏóëÏÖÄ Î≥µÏÇ¨
                        </button>
                    </div>
                </form>
            </div>

            </aside>

            <!-- ÏßÄÎèÑ ÏòÅÏó≠ -->
            <div class="map-container">
                <!-- Î™®Îìú Ï†ÑÌôò Î≤ÑÌäº -->
                <div class="mode-switcher">
                    <button class="mode-button active" data-mode="click">ÌÅ¥Î¶≠</button>
                    <button class="mode-button" data-mode="search">Í≤ÄÏÉâ</button>
                    <button class="mode-button" data-mode="hand">ÏÜê</button>
                </div>

                <!-- Î™®Îìú Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ -->
                <div class="mode-indicator">ÌÅ¥Î¶≠ Î™®Îìú</div>

                <!-- Í≤ÄÏÉâ ÏûÖÎ†• (Í≤ÄÏÉâ Î™®Îìú Ï†ÑÏö©) -->
                <div class="search-input-container search-only" style="display:none;">
                    <input type="text" id="searchInput" placeholder="Ï£ºÏÜå, ÏßÄÎ≤à, ÏÜåÏú†ÏûêÎ™ÖÏúºÎ°ú Í≤ÄÏÉâ">
                    <button id="searchButton">Í≤ÄÏÉâ</button>
                    <button id="clearSearchButton">ÏßÄÏö∞Í∏∞</button>
                </div>

                <!-- Í≤ÄÏÉâ Í≤∞Í≥º (Í≤ÄÏÉâ Î™®Îìú Ï†ÑÏö©) -->
                <div class="search-results-container search-only" style="display:none;">
                    <div class="search-results-header">Í≤ÄÏÉâ Í≤∞Í≥º</div>
                    <div id="searchResults" class="search-results-body"></div>
                </div>

                <div id="map"></div>
                <div id="pano" style="display:none;"></div>
            </div>
        </div>
    </div>

    <!-- Î™®Îã¨ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- Ï∫òÎ¶∞Îçî Î™®Îã¨ -->
    <div id="calendarModal" class="modal" style="display: none;">
        <div class="modal-content calendar-modal">
            <div class="modal-header">
                <h2>ÏóÖÎ¨¥ Ï∫òÎ¶∞Îçî</h2>
                <span class="close" onclick="closeCalendarModal()">&times;</span>
            </div>
            <div class="modal-body">
                <iframe id="calendarIframe" 
                        src="https://calendar.google.com/calendar/embed?height=600&wkst=2&bgcolor=%23ffffff&ctz=Asia%2FSeoul&showTitle=0&showNav=1&showDate=1&showPrint=0&showTabs=1&showCalendars=1&showTz=0&mode=MONTH&src=ko.south_korea%23holiday%40group.v.calendar.google.com&color=%230B8043" 
                        style="border: 0; width: 100%; height: 500px;" 
                        frameborder="0" 
                        scrolling="yes">
                </iframe>
            </div>
            <div class="modal-footer">
                <input type="text" id="calendarUrl" placeholder="Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî URL ÎòêÎäî Ïù¥Î©îÏùº">
                <button onclick="updateCalendar()" class="btn-primary">Ï†ÅÏö©</button>
                <button onclick="closeCalendarModal()" class="btn-secondary">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Î∞±ÏóÖ Í¥ÄÎ¶¨ Î™®Îã¨ -->
    <div id="backupModal" class="modal" style="display: none;">
        <div class="modal-content backup-modal">
            <div class="modal-header">
                <h2>üì¶ Î∞±ÏóÖ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h2>
                <span class="close" onclick="closeBackupModal()">&times;</span>
            </div>
            <div class="modal-body">
                
                <!-- Î∞±ÏóÖ ÏÉÅÌÉú ÎåÄÏãúÎ≥¥Îìú -->
                <div class="backup-status-section">
                    <h3>üîÑ Î∞±ÏóÖ ÏÉÅÌÉú</h3>
                    <div class="backup-status-grid">
                        <div class="status-card daily-backup">
                            <h4>üìÖ ÏùºÏùº Î∞±ÏóÖ (Supabase)</h4>
                            <div class="status-info">
                                <span id="dailyBackupStatus">ÌôïÏù∏ Ï§ë...</span>
                                <span id="dailyBackupTime" class="backup-time"></span>
                            </div>
                            <button class="backup-btn" onclick="performManualBackup('daily')">ÏàòÎèô Î∞±ÏóÖ</button>
                        </div>
                        <div class="status-card monthly-backup">
                            <h4>üìÜ ÏõîÍ∞Ñ Î∞±ÏóÖ (Google Drive)</h4>
                            <div class="status-info">
                                <span id="monthlyBackupStatus">ÌôïÏù∏ Ï§ë...</span>
                                <span id="monthlyBackupTime" class="backup-time"></span>
                            </div>
                            <button class="backup-btn" onclick="performManualBackup('monthly')">ÏàòÎèô Î∞±ÏóÖ</button>
                        </div>
                    </div>
                </div>
                
                <!-- Î∞±ÏóÖ ÌûàÏä§ÌÜ†Î¶¨ -->
                <div class="backup-history-section">
                    <h3>üìã Î∞±ÏóÖ ÌûàÏä§ÌÜ†Î¶¨</h3>
                    <div class="backup-history-controls">
                        <button onclick="refreshBackupHistory()">ÏÉàÎ°úÍ≥†Ïπ®</button>
                        <button onclick="exportBackupHistory()">ÌûàÏä§ÌÜ†Î¶¨ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                    </div>
                    <div id="backupHistoryList" class="backup-history-list">
                        <p>Î∞±ÏóÖ ÌûàÏä§ÌÜ†Î¶¨Î•º Î°úÎìúÌïòÎäî Ï§ë...</p>
                    </div>
                </div>
                
                <!-- Î∞±ÏóÖ ÏÑ§Ï†ï -->
                <div class="backup-settings-section">
                    <h3>‚öôÔ∏è Î∞±ÏóÖ ÏÑ§Ï†ï</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>ÏûêÎèô Î∞±ÏóÖ ÌôúÏÑ±Ìôî</label>
                            <label class="switch">
                                <input type="checkbox" id="autoBackupEnabled" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>ÏùºÏùº Î∞±ÏóÖ ÏãúÍ∞Ñ</label>
                            <input type="time" id="dailyBackupTime" value="02:00">
                        </div>
                        <div class="setting-item">
                            <label>Google Drive Ìè¥Îçî</label>
                            <input type="text" id="driveFolder" placeholder="Ìè¥Îçî ID ÏûÖÎ†•" readonly>
                            <button onclick="selectGoogleDriveFolder()">Ìè¥Îçî ÏÑ†ÌÉù</button>
                        </div>
                        <div class="setting-item full-width">
                            <label>Î∞±ÏóÖ ÏïåÎ¶º ÏÑ§Ï†ï</label>
                            <div class="notification-options">
                                <label><input type="checkbox" id="notifySuccess" checked> ÏÑ±Í≥µ Ïãú ÏïåÎ¶º</label>
                                <label><input type="checkbox" id="notifyFailure" checked> Ïã§Ìå® Ïãú ÏïåÎ¶º</label>
                                <label><input type="checkbox" id="browserNotification"> Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶º</label>
                            </div>
                        </div>
                    </div>
                    <button onclick="saveBackupSettings()" class="save-settings-btn">ÏÑ§Ï†ï Ï†ÄÏû•</button>
                </div>
                
            </div>
            <div class="modal-footer">
                <button onclick="performEmergencyBackup()" class="btn-warning">‚ö° Í∏¥Í∏â Î∞±ÏóÖ</button>
                <button onclick="restoreFromBackup()" class="btn-info">üì• Î≥µÏõê</button>
                <button onclick="closeBackupModal()" class="btn-secondary">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    

    <!-- JavaScript -->
    <script src="/js/log-config.js"></script>
    <script src="/js/config-client.js"></script>
    <script src="/js/supabase-config.js"></script>
    <script src="/js/supabase-adapter.js"></script>
    <script src="/js/realtime-sync.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/calendar.js"></script>
    <script src="/js/map.js"></script>
    <script src="/js/parcel.js"></script>
    <script src="/js/parcel-manager.js"></script>
    <script src="/js/mode-manager.js"></script>
    <script src="/js/color-palette.js"></script>
    <script src="/js/search-mode.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/memo-markers.js"></script>
    <script src="/js/backup-manager.js"></script>
    <script src="/js/sheets.js"></script>
    <script src="/js/mobile-handler.js"></script>
    <!-- data-persistence-manager.js ÎπÑÌôúÏÑ±Ìôî - LocalStorageÏôÄ SupabaseÎßå ÏÇ¨Ïö© -->
    <!-- <script src="/js/data-persistence-manager.js"></script> -->
    <script src="/js/parcel-restore-helper.js"></script>
    <script src="/js/advanced-backup-manager.js"></script>
    <script src="/js/backup-ui.js"></script>
    <script src="/js/realtime-autosave.js"></script>
    <script src="/js/debug-save-system.js"></script>
    <script src="/js/app-init.js"></script>
    <script>
        // Î™®Îìú Ï†ÑÌôò Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.addEventListener('DOMContentLoaded', function() {
            // Î™®Îìú Ï†ÑÌôò Î≤ÑÌäº
            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.dataset.mode;

                    // Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú Î≥ÄÍ≤Ω
                    modeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // Î™®Îìú Ï†ÑÌôò
                    if (window.ModeManager) {
                        window.ModeManager.switchMode(mode);
                    }
                });
            });

            // Í≤ÄÏÉâ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÏûêÎèô Î™®Îìú Ï†ÑÌôò
            const searchBtn = document.getElementById('searchBtn');
            const searchInput = document.getElementById('searchInput');

            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    const query = searchInput.value.trim();
                    if (query && window.SearchModeManager) {
                        window.SearchModeManager.executeSearch({
                            query: query,
                            searchType: 'all'
                        });
                    }
                });
            }

            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const query = this.value.trim();
                        if (query && window.SearchModeManager) {
                            window.SearchModeManager.executeSearch({
                                query: query,
                                searchType: 'all'
                            });
                        }
                    }
                });
            }

            // Í≤ÄÏÉâ Ï¥àÍ∏∞Ìôî Î≤ÑÌäº
            const clearSearchBtn = document.getElementById('clearSearchBtn');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', function() {
                    if (window.SearchModeManager) {
                        window.SearchModeManager.clearSearch();
                    }
                });
            }

            // Î™®Îìú Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            window.addEventListener('modeChanged', function(e) {
                const { currentMode } = e.detail;

                // Í≤ÄÏÉâ Î™®Îìú Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÌëúÏãú/Ïà®ÍπÄ
                const searchIndicator = document.querySelector('.search-mode-indicator');
                if (searchIndicator) {
                    searchIndicator.style.display = currentMode === 'search' ? 'flex' : 'none';
                }

                // ÏÉâÏÉÅ Ìå®ÎÑê Î™®Îìú ÌëúÏãú
                const modeBadge = document.querySelector('.mode-badge');
                if (modeBadge) {
                    if (currentMode === 'click') {
                        modeBadge.textContent = 'ÌÅ¥Î¶≠ Î™®Îìú';
                        modeBadge.style.display = 'inline-block';
                    } else {
                        modeBadge.style.display = 'none';
                    }
                }
            });
        });
    </script>
</body>
</html>